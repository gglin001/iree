{
  "version": 8,
  "configurePresets": [
    {
      "name": "iree_llvm",
      "description": "for iree_llvm docker env",
      "generator": "Ninja",
      "binaryDir": "${sourceDir}/build",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "CMAKE_INSTALL_PREFIX": "${sourceDir}/build/install",
        "CMAKE_EXPORT_COMPILE_COMMANDS": true,
        "CMAKE_C_COMPILER": "/usr/bin/clang",
        "CMAKE_CXX_COMPILER": "/usr/bin/clang++",
        "CMAKE_INSTALL_RPATH_USE_LINK_PATH": true,
        "IREE_ERROR_ON_MISSING_SUBMODULES": false,
        "IREE_ENABLE_LLD": true,
        "IREE_BUILD_TESTS": false,
        "IREE_BUILD_SAMPLES": false,
        "IREE_TARGET_BACKEND_VMVX": true,
        "IREE_TARGET_BACKEND_LLVM_CPU": true,
        "IREE_TARGET_BACKEND_VULKAN_SPIRV": true,
        "IREE_TARGET_BACKEND_LLVM_CPU_WASM": false,
        "IREE_TARGET_BACKEND_METAL_SPIRV": false,
        "IREE_TARGET_BACKEND_ROCM": false,
        "IREE_TARGET_BACKEND_CUDA": false,
        "IREE_HAL_DRIVER_CUDA": false,
        "IREE_BUILD_PYTHON_BINDINGS": true,
        "IREE_BUILD_BUNDLED_LLVM": false,
        "LLVM_DIR": "/iree-llvm-project/build/install/lib/cmake/llvm",
        "LLD_DIR": "/iree-llvm-project/build/install/lib/cmake/lld",
        "MLIR_DIR": "/iree-llvm-project/build/install/lib/cmake/mlir",
        "Clang_DIR": "/iree-llvm-project/build/install/lib/cmake/clang",
        "IREE_ENABLE_ASSERTIONS": true
      }
    },
    {
      "name": "iree_llvm_riscv",
      "description": "riscv",
      "generator": "Ninja",
      "binaryDir": "${sourceDir}/build-riscv",
      "environment": {
        "COMMON_CMAKE_C_FLAGS": "-DIREE_PLATFORM_GENERIC=1 -DIREE_SYNCHRONIZATION_DISABLE_UNSAFE=1 -DIREE_FILE_IO_ENABLE=0 -DIREE_TIME_NOW_FN='{return 0;}' -DIREE_DEVICE_SIZE_T=uint64_t -DPRIdsz=PRIu64"
      },
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Release",
        "CMAKE_INSTALL_PREFIX": "${sourceDir}/build-riscv/install",
        "CMAKE_EXPORT_COMPILE_COMMANDS": true,
        "CMAKE_VERBOSE_MAKEFILE": false,
        "IREE_ERROR_ON_MISSING_SUBMODULES": false,
        "IREE_BUILD_TESTS": false,
        "IREE_BUILD_SAMPLES": true,
        "IREE_BUILD_COMPILER": false,
        "IREE_ENABLE_WERROR_FLAG": false,
        "IREE_HOST_BIN_DIR": "${sourceDir}/build/tools",
        "CMAKE_SYSTEM_NAME": "Generic",
        "CMAKE_SYSTEM_PROCESSOR": "riscv64",
        "CMAKE_C_STANDARD": "11",
        "CMAKE_C_EXTENSIONS": false,
        "IREE_ENABLE_LLD": false,
        "CMAKE_C_COMPILER": "riscv64-unknown-elf-gcc",
        "CMAKE_CXX_COMPILER": "riscv64-unknown-elf-g++",
        "CMAKE_AR": "riscv64-unknown-elf-ar",
        "CMAKE_RANLIB": "riscv64-unknown-elf-ranlib",
        "CMAKE_STRIP": "riscv64-unknown-elf-strip",
        "CMAKE_C_FLAGS": "-mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS}",
        "CMAKE_CXX_FLAGS": "-mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS}",
        "IREE_HAL_DRIVER_DEFAULTS": false,
        "IREE_HAL_DRIVER_LOCAL_SYNC": true,
        "IREE_HAL_EXECUTABLE_LOADER_DEFAULTS": false,
        "IREE_HAL_EXECUTABLE_LOADER_EMBEDDED_ELF": true,
        "IREE_HAL_EXECUTABLE_LOADER_VMVX_MODULE": true,
        "IREE_HAL_EXECUTABLE_PLUGIN_DEFAULTS": false,
        "IREE_HAL_EXECUTABLE_PLUGIN_EMBEDDED_ELF": true,
        "IREE_ENABLE_THREADING": false,
        "IREE_ENABLE_ASSERTIONS": true
      }
    },
    {
      "name": "iree_llvm_riscv_semihost",
      "inherits": "iree_llvm_riscv",
      "cacheVariables": {
        // `${fileDir}/riscv-gnu-toolchain` is riscv gnu toolchain for bare metal
        "CMAKE_SYSROOT": "${fileDir}/riscv-gnu-toolchain",
        // TODO: why need empty `-L`
        "CMAKE_C_FLAGS": "-mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} -L -nostdlib -lgcc -lc -lm -lsemihost",
        "CMAKE_CXX_FLAGS": "-mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} -L -nostdlib -lgcc -lc -lm -lsemihost"
      }
    },
    {
      "name": "iree_llvm_riscv_picolibc",
      "inherits": "iree_llvm_riscv",
      "environment": {
        // `${fileDir}/picolibc` is picolibc build with riscv64-unknown-elf-gcc, build dir is `build-meson`
        "PICOLIBC_DIR": "${fileDir}/picolibc",
        "SPECS": "$env{PICOLIBC_DIR}/build-meson/picolibc.specs",
        "LDSCRIPT": "${fileDir}/riscv.ld"
      },
      "cacheVariables": {
        "CMAKE_C_FLAGS": "-mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} -specs=$env{SPECS} -T$env{LDSCRIPT} --oslib=semihost --crt0=semihost",
        "CMAKE_CXX_FLAGS": "-mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} -specs=$env{SPECS} -T$env{LDSCRIPT} --oslib=semihost --crt0=semihost"
      }
    },
    {
      "name": "iree_llvm_riscv_picolibc_clang",
      "inherits": "iree_llvm_riscv",
      "environment": {
        // for `__tls_get_addr` not found
        "EXTRA_CMAKE_C_FLAGS": "-Xclang -enable-tlsdesc"
      },
      "cacheVariables": {
        "IREE_ENABLE_LLD": true,
        // `${fileDir}/riscv-toolchain` is riscv toolchain for bare metal
        "CMAKE_C_COMPILER": "${fileDir}/riscv-toolchain/bin/clang",
        "CMAKE_CXX_COMPILER": "${fileDir}/riscv-toolchain/bin/clang++",
        "CMAKE_AR": "${fileDir}/riscv-toolchain/bin/llvm-ar",
        "CMAKE_RANLIB": "${fileDir}/riscv-toolchain/bin/llvm-ranlib",
        "CMAKE_STRIP": "${fileDir}/riscv-toolchain/bin/llvm-strip",
        "CMAKE_LINKER": "${fileDir}/riscv-toolchain/bin/ld.lld",
        "CMAKE_SYSROOT": "${fileDir}/riscv-toolchain/lib/clang-runtimes/riscv64-unknown-elf/rv64imac/lp64",
        "CMAKE_C_FLAGS": "--target=riscv64-unknown-elf -mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} $env{EXTRA_CMAKE_C_FLAGS} -nostdlib  -lc -lm -lclang_rt.builtins -lcrt0-semihost -lsemihost -T${fileDir}/riscv.ld",
        "CMAKE_CXX_FLAGS": "--target=riscv64-unknown-elf -mcmodel=medany -O3 -march=rv64imac -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} $env{EXTRA_CMAKE_C_FLAGS} -nostdlib -lc -lm -lclang_rt.builtins -lcrt0-semihost -lsemihost -T${fileDir}/riscv.ld"
      }
    },
    {
      "name": "iree_llvm_riscv_picolibc_clang_rv64ima_lp64_semihost",
      "inherits": "iree_llvm_riscv_picolibc_clang",
      "binaryDir": "${sourceDir}/build-riscv-semihost",
      "cacheVariables": {
        "CMAKE_INSTALL_PREFIX": "${sourceDir}/build-riscv-semihost/install",
        "CMAKE_SYSROOT": "${fileDir}/riscv-toolchain/lib/clang-runtimes/riscv64-unknown-elf/rv64ima/lp64",
        "CMAKE_C_FLAGS": "--target=riscv64-unknown-elf -mcmodel=medany -O3 -march=rv64ima -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} $env{EXTRA_CMAKE_C_FLAGS} -nostdlib  -lc -lm -lclang_rt.builtins -lcrt0-semihost -lsemihost -T${fileDir}/riscv.ld",
        "CMAKE_CXX_FLAGS": "--target=riscv64-unknown-elf -mcmodel=medany -O3 -march=rv64ima -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} $env{EXTRA_CMAKE_C_FLAGS} -nostdlib -lc -lm -lclang_rt.builtins -lcrt0-semihost -lsemihost -T${fileDir}/riscv.ld"
      }
    },
    {
      "name": "iree_llvm_riscv_picolibc_clang_rv64ima_lp64_dummyhost",
      "inherits": "iree_llvm_riscv_picolibc_clang",
      "binaryDir": "${sourceDir}/build-riscv-dummyhost",
      "cacheVariables": {
        "CMAKE_INSTALL_PREFIX": "${sourceDir}/build-riscv-dummyhost/install",
        "CMAKE_SYSROOT": "${fileDir}/riscv-toolchain/lib/clang-runtimes/riscv64-unknown-elf/rv64ima/lp64",
        "CMAKE_C_FLAGS": "--target=riscv64-unknown-elf -mcmodel=medany -O3 -march=rv64ima -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} $env{EXTRA_CMAKE_C_FLAGS} -nostdlib  -lc -lm -lclang_rt.builtins -lcrt0 -ldummyhost -T${fileDir}/riscv.ld",
        "CMAKE_CXX_FLAGS": "--target=riscv64-unknown-elf -mcmodel=medany -O3 -march=rv64ima -mabi=lp64 $env{COMMON_CMAKE_C_FLAGS} $env{EXTRA_CMAKE_C_FLAGS} -nostdlib -lc -lm -lclang_rt.builtins -lcrt0 -ldummyhost -T${fileDir}/riscv.ld"
      }
    }
  ]
}
